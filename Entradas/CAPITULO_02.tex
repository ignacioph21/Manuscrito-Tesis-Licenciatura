\chapter{Sensor capacitivo} 

\begin{figure}[th!]
	\centering
	\includegraphics[width=0.987\linewidth]{Figuras/Sensor/Timeline/Timeline_v2}
	\caption{Diagrama esquemático de los pasos para la construcción y caracterización del sensor capacitivo para la altura de la superficie libre.}
	\label{fig:timelinev2}
\end{figure}



\section{Principio de funcionamiento} 

\subsection{La sonda} 

Al sumergir un alambre de cobre esmaltado en un fluido conductor, como se esquematiza en la Figura \ref{fig:esquema_fundamento}, el recubrimiento aislante actuará a modo de medio dieléctrico entre los conductores. En el caso de dos conductores cilíndricos coaxiales, de radios $r_1<r_2$, cuyo intersticio se encuentra lleno de un medio con permitividad $\varepsilon$ y permeabilidad $\mu$, se tienen una capacitancia ($C'$) e inductancia ($L'$) por unidad de longitud, dadas por % \cite{gordillozavaletaNonpropagatingHydrodynamicSolitons2012} % Para de  

\begin{subequations}
	\begin{equation}
		C' = 2\pi\varepsilon\ln^{-1}\left(\frac{r_2}{r_1}\right)
	\end{equation} 
	\begin{equation}
		L' = \frac{\mu}{2\pi}\ln\left(\frac{r_2}{r_1}\right)
	\end{equation} 
\end{subequations}

\begin{figure}[th!]
	\centering
	\includegraphics[width=0.71089\linewidth]{"Figuras/Sensor/Esquema fundamento/esquema_fundamental"}
	\caption{Esquema de un alambre esmaltado sumergido en un fluido conductor, puesto a Tierra mediante otro alambre sin aislar. El alambre de cobre se encuentra a conectado a un potencial externo $V_{ext}$. El recubrimiento aislante actuará como medio dieléctrico, comportándose el sistema  efectivamente como un capacitor, cuya capacitancia depende de la altura sumergida. } 
	\label{fig:esquema_fundamento}
\end{figure}

  
La porción sumergida del alambre puede modelarse como una sucesión de segmentos de longitud $dl$, cada uno de los cuales agrega al circuito una capacitancia $dC = C'dl$ en paralelo y una inductancia $dL = L'dl$ en serie. De esta forma, es posible escribir la impedancia $Z(l+dl)$ recursivamente, a partir de la impedancia $Z(l)$ y la del segmento infinitesimal siguiente:  

\begin{equation}
	Z(l+dl) = j\omega L'dl + \left(\frac{1}{Z(l)} + \frac{1}{j\omega C' dl}\right)^{-1} 
\end{equation}  

Con $j$ la unidad imaginaria. Tomando $dl\rightarrow0$ y reteniendo términos hasta primer orden, resulta en una ecuación diferencial para $Z(l)$ 

\begin{equation}
	\frac{dZ}{dl} = j\omega L' - j\omega C'Z^2
\end{equation} 

Ésta puede resolverse sumando la condición de contorno $Z(0)=\infty$, que refleja la ausencia de un camino capacitivo hacia el fluido si el alambre no está sumergido, pudiendo así considerar al circuito como abierto. El resultado es el siguiente 

\begin{equation}
	Z(l) = j\sqrt{\frac{L'}{C'}} \tan\left(\omega \sqrt{L'C'} l - \pi/2\right)
\end{equation}

En el caso particular en que $l$ es lo suficientemente pequeño ($\omega\mu\varepsilon l\ll 1$) resulta suficiente con tomar la expansión de esta solución a primer orden 

\begin{equation}
	Z(l) \approx \frac{1}{j\omega C' l} + \mathcal{O}\left(\frac{1}{L'C'^2\omega^2l^3}\right)
\end{equation}

De este modo, se puede observar que en este régimen el sistema se comportará básicamente como un capacitor de capacitancia $C'l$, de modo que, midiendo la capacitancia de este circuito, será posible inferir la altura sumergida del alambre y, por tanto, la altura de la superficie libre. 

Ahora bien, más que la longitud total sumergida del alambre, o sonda, la cantidad de interés será el apartamiento $\Delta l$ respecto de una posición de equilibrio $l_{0}$ (para la superficie libre en reposo), tal que $l=l_{0}+\Delta l$. Teniendo esta consideración en cuenta, la capacitancia de la sonda será $C_s = C_{0} + \Delta C$, y el objetivo de la medición será esta $\Delta C$, directamente relacionada a los desplazamientos de la superficie libre. % o 



Un último punto importante es que, si bien el desarrollo hasta aquí se llevó a cabo suponiendo casos donde el fluido alrededor del alambre se mantuviera estático, será posible levantar ésta hipótesis, y considerar que $\Delta l=\Delta l(t)$, siempre que las variaciones sean lo suficientemente lentas respecto al tiempo de respuesta típico del sistema: % la superficie libre a un  

\begin{equation}
	\tau_s = \alpha\frac{\varepsilon}{\sigma}\left(\frac{r_1}{r_1+r_2}\right)  
\end{equation}

Donde $\alpha$ es una constante que depende de la geometría de los conductores, y $\sigma$ es la conductividad del fluido. Se asumirá que esta condición se cumple en general. 

El único caso en que fue posible observar una limitación en el funcionamiento del sensor vinculada a ésto fue al aumentar varios órdenes de magnitud la conductividad del fluido  (agregando sal al agua destilada, en el orden de $10^{4}$ ppm) aunque para agua el agua de red el funcionamiento fue, hasta donde se pudo observar, equivalente al del agua destilada, a diferencia de lo reportado en \cite{gordillozavaletaNonpropagatingHydrodynamicSolitons2012}. % en  3-


% Esta condición implica que el sensor podría no funcionar correctamente en aguas 
% Se puede mostrar que, en general, esta condición se cumplirá para agua destilada \cite{gordillozavaletaNonpropagatingHydrodynamicSolitons2012}. % para e agua destilada éste $$ válida 





\subsection{Medición de la capacitancia} 
En la Sección anterior se mostró cómo la medición de la capacitancia de un alambre esmaltado sumergido permite determinar los desplazamientos de la superficie libre respecto de una posición en equilibrio.  % longitud que éste se encuentra inmerso ($l$) a 


\begin{figure}[th!]
	\centering
	\includegraphics[width=0.7018\linewidth]{"Figuras/Setups/circuito_completo v3"}
	\caption{}
	\label{fig:circuitocompleto-v3}
\end{figure}

Esta medición puede llevarse acabo conectando la sonda al circuito de la Figura \ref{fig:circuitocompleto-v3}, que se corresponde a su conexión en paralelo al capacitor de un circuito RLC serie (de parámetros base $R$, $L$ y $C$), teniendo como efecto la modificación de la capacitancia efectiva del mismo. De esta forma se tendrá un circuito RLC serie equivalente, cuya capacitancia será ahora $C_{\text{EQ}}(t)=C_0+C_s(t)$.   

% . % sumergido conectar la sonda 
% Este arreglo á lo cual rá el r  

Al conectar éste circuito a una fuente de corriente alterna de frecuencia angular $\omega$ y amplitud $V$ la ecuación para la corriente $I(t)$ vendrá dada por 

\begin{equation}
	V \cos(\omega t) = \frac{d^2I(t)}{dt^2} + \frac{R}{L} \frac{dI(t)}{dt} + \frac{1}{C_{\text{EQ}}(t)L} I(t)  
	\label{eq:circuit_eq}
\end{equation}

Donde $C_{\text{EQ}}(t) = C + C_0 + \Delta C(t)\equiv C_q + \Delta C(t)$, definiendo $C_q$ como la capacitancia efectiva cuando la superficie libre se encuentra en reposo. Si las variaciones en la capacitancia son lo suficientemente lentas respecto a la frecuencia se puede asumir una solución de la forma $I(t)=I_0(t)\cos(\omega t + \phi(t))$, en analogía a lo que ocurriría en el caso estático para $C=\text{cte}$.  Cuando las variaciones de la capacitancia sean lo suficientemente pequeñas ($\Delta C/C_q\ll 1$) será suficiente con  un desarrollo a primer orden para describir la fase $\phi(t)$:      % pod puede escribirse _{\text{EQ}}  como 

\begin{equation}
		\tan(\phi) = -\frac{1}{R} \left[\omega L - \frac{1}{\omega C_q}\right] - \frac{1}{R} \frac{\Delta C}{\omega C_q^2} + \mathcal{O}\left[\left(\frac{\Delta C}{C_q}\right)^2\right] 
\end{equation}

Es posible eliminar además el primer término de este desarrollo si se elige trabajar con la frecuencia de resonancia $\omega=1/\sqrt{LC_q}$. De esta forma quedaría simplemente 

\begin{equation}
	\tan(\phi) = -Q_F \frac{\Delta C}{C_q} 
\end{equation}

Donde $Q_F=\frac{1}{R}\sqrt{L/C_q}$ es el factor de calidad del RLC. Finalmente, si el término de la derecha también es mucho menor a uno se puede aproximar $\tan(\phi)\approx\phi$ y queda una relación lineal entre $\phi$ y la variación de capacitancia, y por tanto, con las variaciones en la altura sumergida del sensor. 

\begin{equation}
	\phi(t) = -Q_{F} \frac{\Delta C(t)}{C_q} = -Q_{F}\frac{C'}{C_q} \Delta l(t) 
\end{equation} 

Y al ajustar los parámetros del RLC (y $Q_F$ en consecuencia) es posible ajustar la sensitividad del sensor, ya que si por ejemplo se quiere medir un rango muy amplio de $\Delta l$, bastaría con hacer que $Q_{F}$ sea más pequeño. % p  







\subsection{Medición de la fase} 
Hasta aquí se demostró conceptualmente cómo es posible encontrar una relación lineal entre la fase ($\phi$) de la corriente de la sonda y las variaciones en su altura sumergida ($\Delta l$) al conectarla en paralelo al capacitor de  un RLC serie. El paso final para completar la descripción del sensor será, entonces, hallar un método para la medición de dicha fase. % do m o desplazamient   

Con este fin se empleará la técnica de \textit{demodulación homodina}, que utiliza una señal de referencia para obtener la amplitud y fase relativa de la señal de interés (en este caso la caída de tensión sobre la resistencia $R$). % ó 

El primer paso consistirá en modular la señal de interés, a la cual se llamará $A(t)$, con alguna frecuencia, obteniendo entonces una nueva señal 

\begin{equation}
	S(t) = A(t)\cos(\omega_r t)
\end{equation} 

Es importante que la frecuencia de modulación sea mucho más rápida que las frecuencias características de $A(t)$, para que pueda captar todas sus variaciones correctamente. En este caso, la tensión sobre la resistencia ya tendrá la misma forma de $S(t)$, con lo cual no es necesario realizar este primer paso explícitamente. % e  

Luego, se debe \textit{mixear} la señal  modulada con la de referencia, $R(t)=\cos(\omega_r t)$, que en este caso será la tensión alterna que alimenta al circuito\footnote{\normalsize La referencia podría tener en principio una frecuencia distinta a la de modulación, pero por simplicidad, y porque en este sistema será así, se considerarán iguales.},  obteniendo entonces 

\begin{equation}
	M(t) = S(t)R(t) = A(t)/2 \; \big(1+\cos(2\omega_r t)\big) 	
\end{equation} 

Si hubiese ruido eléctrico $N(t)$ sumando, la señal sería $M(t) = S(t)R(t) + N(t)R(t)$. El efecto de este mixeo será centrar el ruido en $\omega_r$, recordando que un producto en tiempo se traduce como una convolución en frecuencia. Además, quedan dos copias de la señal de interés, una centrada en 0 y otra en $2\omega_r$. 

Finalmente, se debe aplicar un filtro pasabajos, de frecuencia de corte $\omega_c$, o tiempo de integración $\tau_c=2\pi/\omega_c$. Siempre que $\omega_c<\omega_r$ el efecto de este filtro será no dejar pasar, ni la copia de la señal en $2\omega_r$, ni al ruido, y obtener así la amplitud $A(t)/2$.   % por además total y , 

\missingfigure{Esquema Lockin } 

Si inicialmente la señal hubiese tenido una fase respecto a la señal de referencia, o sea, $S(t)=A(t)\cos(\omega_r t + \phi_r)$, como ocurrirá en este caso, habría que repetir el mismo procedimiento con una señal de referencia que tenga 90$^\circ$ de desfasaje respecto a $R(t)$, a la cual se la conoce como \textit{cuadratura}. Al final se obtendrá para la referencia una señal $X(t) = A(t)/2 \; \cos(\phi_r)$, que se conoce como componente homodina, y para la cuadratura, una señal $Y(t)=A(t)/2 \; \sin(\phi_r)$, que es la componente heterodina. Con éstas resulta fácil obtener la amplitud y fase como: 

\begin{subequations}
	\begin{equation}
		A^2 = 4 (X^2+Y^2) 
	\end{equation} 
	\begin{equation}
		\phi_r = \arctan(Y/X)
	\end{equation}
\end{subequations}  % se  a ,  y $$. 

Por lo general, se utiliza un amplificador lock-in para llevar a cabo esta técnica de manera síncrona, pero se discutirá más sobre su implementación más adelante. % á



\section{Resolución numérica del circuito} 
Antes de iniciar con la construcción del sensor en el laboratorio, se empezó caracterizando numéricamente el comportamiento del circuito descripto en las secciones anteriores, esto es, la resolución de la ecuación \eqref{eq:circuit_eq}. El objetivo de este paso preliminar fue, por una parte verificar que la solución hallada bajo las distintas aproximaciones funcionaba correctamente, pero además, poder probar distintas combinaciones de parámetros y determinar qué efectos tendrían éstas sobre el funcionamiento del sensor. A continuación se mencionan brevemente algunas de las conclusiones más relevantes que se pudieron observar. % la ecuación ss resolviendo para  ver 

Se pudo verificar que la fase se relaciona linealmente con $\Delta l$ hasta cierto punto. Por ejemplo, para una señal aleatoria (amplitud constante entre 0-6 Hz y fase aleatoria) como las que podrían ser de interés medir en la superficie libre, con los valores de la Tabla \ref{tab:rlc_valores} que eventualmente se terminaron usando, la reconstrucción de la altura es la de la Figura \ref{fig:diferencias}.  % de esta forma  


\begin{figure}[th!]
	\centering 
	\includegraphics[width=0.87\linewidth]{"Figuras/Sensor/Pruebas numéricas/Diferencias"}
	\caption{}
	\label{fig:diferencias}
\end{figure}

Donde los errores son del orden del 1 \% aproximadamente.  Si los desplazamientos  $\Delta l$ se vuelven lo suficientemente grandes, como para que $\Delta C\sim C_q$, se produce una saturación en la fase medida.  % se intentade a partir del cual a 



\missingfigure{Saturación}




Se puede contrarrestar este efecto como ya se explicó modificando los parámetros del circuito, siendo la opción más sencilla disminuir el factor de calidad $Q_F$, o bien disminuyendo la capacitancia por unidad de longitud $C'$ del alambre, lo cual implica cambiarlo por otro. % yendo 

Otro efecto interesante que se pudo observar es que, si se intentan medir variaciones en $\Delta l$ demasiado rápidos respecto se produce histéresis en el sistema. 


\missingfigure{Histéresis} 


Aunque ninguno de estos efectos adversos se llegaron a observar en la práctica. 



\section{Prueba de un circuito equivalente} 
Siguiendo con el enfoque constructivo el siguiente paso fue realizar una prueba conceptual del circuito. Para esto se armó un circuito RLC serie, a cuya capacitancia se le fue conectando en paralelo capacitancias de distintos valores, y midiendo en cada caso la diferencia de fase respecto de la señal de referencia. 


\begin{figure}[th!]
	\centering
	\includegraphics[width=0.87\linewidth]{"Figuras/Sensor/Prueba protoboard/Datos_osciloscopio_unidades"}
	\caption{}
	\label{fig:datososciloscopiounidades}
\end{figure}






\section{Prototipado} %  y prueba  





\begin{figure}[th!]
	\centering
	\includegraphics[width=0.87\linewidth]{"Figuras/Sensor/El sensor/dibujo_sensor_modelo"}
	\caption{}
	\label{fig:dibujosensormodelo}
\end{figure}


Los valores nominales de los elementos utilizados para el sensor son los de la Tabla \ref{tab:rlc_valores}. Estos valores se eligieron luego de varias pruebas preliminares, ya que fueron los que mejores resultados permitieron obtener para los desplazamientos típicos de la superficie libre con los que se trabajó (de un orden máximo de 1 cm).   

\begin{table}[h]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\textbf{Elemento} & \textbf{Valor} \\ \hline
		R & $(360 \pm 40)\,\Omega$ \\ \hline
		L & $(10 \pm 1)\,\text{mH}$ \\ \hline
		C & $(560 \pm 60)\,\text{pF}$ \\ \hline
	\end{tabular}
	\caption{.}
	\label{tab:rlc_valores}
\end{table} 


Es importante resaltar que, como muestra la Figura \ref{fig:circuitocompleto-v3}, el elemento a Tierra en el RLC debe ser el capacitor, ya que el agua estará a este potencial en cualquier caso, y de conectar, por ejemplo, la resistencia a Tierra, se generaría un cortocircuito. Se observó que, al tener este elemento  a Tierra en el RLC (independientemente de si la sonda estaba conectada), se produce una disminución en la frecuencia de resonancia del mismo, que se atribuye al acoplamiento de capacitancias parásitas $C_p$, que tienen como efecto sumar a la $C$ utilizada ($C_p\;\sim$ 200 pF), con lo cual se debe asumir que es levemente mayor al valor reportado en la Tabla \ref{tab:rlc_valores}.  % de un orden similar   el capacitor


De esta manera, para el sensor en el aire la capacitancia total $C_{\text{EQ}}$ resultó ser aproximadamente 400 pF mayor a la $C$ base del RLC, con lo cual $C_{\text{EQ}}\;\sim$ 1000 pF. Con el sensor sumergido aproximadamente 1 cm en agua destilada la variación en la capacitancia es del orden de $\Delta C\;\sim$ 10 pF, de forma que se verifica la hipótesis que hicimos anteriormente para llegar a una relación lineal entre la fase y los desplazamientos de altura, resultando el cociente $\Delta C/C\sim0.01\ll1$.   % \approx 

Las frecuencias de resonancia típicas con las que se trabajó fueron del orden de 52 kHz, para los elementos previamente mencionados, ajustándolas más finamente en cada caso, antes de la medición, aunque cuando por distintos motivos no fue posible realizar este ajuste el efecto fue simplemente la suma de un $\phi_0$ a las señales, que puede eliminarse al restar el valor medio, ya que finalmente la cantidad de interés será la variación de altura. % n a los fines . % En algunos casos se observó una deriva muy lenta  

La capacitancia por unidad de longitud para el cable de cobre elegido se estimó en el orden de $1$ pF/mm. % $0^{-12}$


% De esta manera, a capacitancia total $Cq$ para el sensor sin sumergir resultó de , con una frecuencia de resonancia de $f_s=(53.19\pm0.01)$ kHz, mientras que con el sensor sumergido fue de $C_q=(895\pm90)$ pF y una frecuencia $f_s=(52.60\pm0.01)$ kHz. 

%Para el sensor en el aire la capacitancia total $C_q$ que se debe sumar al $C$ base resultó ser del orden de 400 pF, a la cual contribuye entonces la $C_0$ y las capacitancias parásitas, que se estiman del orden de 200 pF. De esta forma la capacitancia total Al sumergir aproximadamente 1 cm el sensor en agua destilada se observa una variación en la capacitancia de entre 10 y 20 pF, lo cual sería consistente con la hipótesis de $C/\Delta C\ll 1$. 
%
%Las frecuencias de resonancia típicas con las que se trabajó fueron en consecuencia del orden de 52 kHz. 



\section{Placa de adquisición y Lock-in digital} 






\section{Prueba final y calibración} 

\subsection{Montaje} 

\begin{figure}[th!]
	\centering
	\includegraphics[width=0.87\linewidth]{Figuras/Setups/Montaje_calibracion_fondo}
	\caption{}
	\label{fig:montajecalibracion}
\end{figure}

\subsection{Altura vs Altura} 

\begin{figure}[th!]
	\centering
	\includegraphics[width=0.87\linewidth]{"Figuras/Sensor/Series temporales/Series temporales a"}
	\caption{}
	\label{fig:series-temporales-a}
\end{figure}



\begin{figure}[th!]
	\centering
	\includegraphics[width=0.87\linewidth]{"Figuras/Sensor/Motor vs Fase/Motor vs FASE"}
	\caption{}
	\label{fig:motor-vs-fase}
\end{figure}


\subsection{Diferencias} 


\begin{figure}[th!]
	\centering
	\includegraphics[width=0.87\linewidth]{Figuras/Sensor/Diferencias/Diferencias}
	\caption{}
	\label{fig:diferencias}
\end{figure}


